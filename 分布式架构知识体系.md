# 几个问题

1. 何为分布式何为微服务？

2. 为什么需要分布式？

3. 分布式核心理论基础，节点、网络、时间、顺序，一致性？

4. 分布式是系统有哪些设计模式？

5. 分布式有哪些类型？

6. 如何实现分布式？

# 关键词

节点，时间，一致性，CAP，ACID，BASE，P2P，机器伸缩，网络变更，负载均衡，限流，鉴权，服务发现，服务编排，降级，熔断，幂等，分库分表，分片分区，自动运维，容错处理，全栈监控，故障恢复，性能调优

# 基础理论

## 1 从SOA到MSA的进化

**SOA指面向服务框架**

![img](http://ata2-img.cn-hangzhou.img-pub.aliyun-inc.com/ddc52ece0fc35c8b7f5231cfcbb70cac.png)

**MSA微服务框架**

![img](http://ata2-img.cn-hangzhou.img-pub.aliyun-inc.com/02749d7d54109be523a6204fd7657d7f.png)

## 2 网络和节点

#### **节点：**

传统的节点也就是一台单体的物理机，所有的服务都揉进去包括服务和数据库；随着虚拟化的发展，单台物理机往往可以分成多台虚拟机，实现资源利用的最大化，节点的概念也变成单台虚拟机上面服务；近几年容器技术逐渐成熟后，服务已经彻底容器化，也就是节点只是轻量级的容器服务。总体来说，节点就是能提供单位服务的逻辑计算资源的集合。

#### 网络：

分布式架构的根基就是网络，不管是局域网还是公网，没有网络就无法把计算机联合在一起工作，但是网络也带来了一系列的问题。网络消息的传播有先后,消息丢失和延迟是经常发生的事情，我们定义了三种网络工作模式：

1. 同步网络
   - 节点同步执行
   - 消息延迟有限
   - 高效全局锁
2. 半同步网络
   - 锁范围放宽
3. 异步网络
   - 节点独立执行
   - 消息延迟无上限
   - 无全局锁
   - 部分算法不可行

## 3 时间与顺序

慢速物理时空中，时间独自在流淌着，对于串行的事务来说，很简单的就是跟着时间的脚步走就可以，先来后到的发生。而后我们发明了时钟来刻画以往发生的时间点，时钟让这个世界尽然有序。但是对于分布式世界来说，跟时间打交道着实是一件痛苦的事情。分布式世界里面，我们要协调不同节点之间的先来后到关系，但是不同节点本身承认的时间又各执己见，于是我们创造了网络时间协议（NTP）试图来解决不同节点之间的标准时间，但是NTP本身表现并不如人意，所以我们又构造除了逻辑时钟，最后改进为向量时钟：

### NTP的一些缺点

- 节点间时间不同步
- 硬件时钟漂移
- 线程可能休眠
- 操作系统休眠
- 硬件休眠

![img](http://ata2-img.cn-hangzhou.img-pub.aliyun-inc.com/41d9c12120903f36dfcc741be8c2f576.png)
