# 前言

什么是HSF？

集团内部使用的分布式服务框架 *HSF*(High Speed Framework）

# **性能测试概念：**

- **负载测试**
  在确定的负载下系统的行为表现能力，指在确定的时间范围、给定的虚拟用户数量下执行一定数量的事务。

  可以给出关键业务的响应时间等性能指标。

- **压力测试**

–用来获悉系统的能力上限。

–检测系统的健壮性，在高于期望值的压力下系统的反应能力。

- **稳定性测试**

–在特定的硬件、软件、网络等条件下，在持续长时间压力（n*24h）下，系统是否稳定的测试。
- **采用的测试流程：**
负载测试 -> 压力测试 -> 稳定性测试

# 性能测试指标

## 业务性能指标

- Virtue User（虚拟用户）

- Transaction（事务）

- TPS(每秒事务数)

- Response Time（响应时间）

- Concurrency（并发）

- Think Time （思考时间）

## 资源指标

- CPU 资源

- Memory

- 磁盘和网络吞吐量

## 中间件

- GC 垃圾回收（GC频率，时长等）

- 线程池

## 数据库

- SQL耗时

- 命中率

- 锁 

# 方法流程

- 性能测试的目标（http,ftp,JDBC等）和方案

- 测试脚本和数据的准备

- 测试环境的搭建（避免影响线上环境和开发联调环境，配置和线上环境一致等。atep）

- 执行测试（定时定期定量）

- 结果获取和分析（性能指标，服务器指标，中间件指标等等。PAP，alimonitor）

- 性能测试报告（遇到的问题，瓶颈等）

- 调优（服务器，数据库，中间件，代码等）

# 压力工具：Jmeter

- 开源框架，JAVA友好，可扩展，支持多种协议

- 可与PAP集成，提供压测引擎和结果展示

# 压测平台：PAS

- Taobao内部平台

- 压测工具，管理性能测试项目，环境，设置脚本，实施压力，产出结果，发送报告等。

# 性能检测目标

## 服务器

- Linux 应用服务器。

- 具体包括 CPU、Memory、Load、I/O、Disk 等。 

## 数据库: 

- Mysql 

- 具体包括缓存命中、索引、单条 SQL 性能、数据库线程数、数据池连接数等。

## 中间件: 

- Apache

- 具体包括线程数、连接数、日志输出等。

## 网络 

- 防火墙、网卡、网线、吞吐量、吞吐率等。

- 应用服务 

- JVM 内存使用和回收、JAVA 内存使用、Full GC 频率、JAVA 类装入和卸载、日志、线程运行状态(阻塞、等待、正常运行)等。 

## 监控工具

- 具体包括用户执行情况、场景状态、事务响应时间、TPS、Load、CPU 分析图表等。

# 调优

## 服务器

- CPU, Memory等的选择

- 系统最大连接数

- 禁用不必要的服务等等内核参数

## 中间件

- Web连接线程池

- 数据库连接池

- GC策略和参数

## 数据库 

- 数据库一些内置参数的调优（最大连接数，打开的文件描述符限制，接受的数据包大小等等）

- 索引

- 查询语句

- 锁